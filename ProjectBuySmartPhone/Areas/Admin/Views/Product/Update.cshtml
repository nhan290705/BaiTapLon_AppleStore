@using ProjectBuySmartPhone.Models.Domain.Entities
@using ProjectBuySmartPhone.Models.Domain.Enums
@model ProjectBuySmartPhone.Areas.Admin.Models.ViewModels.ProductUpdateVM
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Update Product";
    Layout = "~/Areas/Admin/Views/Shared/MyLayout.cshtml";

    var categories = ViewBag.Categories as List<ProductCategory> ?? new List<ProductCategory>();

}

<link rel="stylesheet" href="~/css/product.css"/>

<div class="card">
    <div class="header d-flex justify-content-between align-items-center">
        <h2 class="mb-0">Update Product</h2>
    </div>
    <div class="body">
        <form asp-area="Admin"
              asp-controller="Product"
              asp-action="Update"
              method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <input asp-for="ProductId" type="hidden" class="form-control" />
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Product Name</label>
                    <input asp-for="ProductName" class="form-control" />
                    <span asp-validation-for="ProductName" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">SKU</label>
                    <input asp-for="Sku" class="form-control" />
                    <span asp-validation-for="Sku" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Slug</label>
                    <input asp-for="Slug" class="form-control" />
                </div>

                <div class="col-md-12 mb-3">
                    <label class="form-label fw-bold">Description</label>
                    <textarea asp-for="Description" rows="3" class="form-control"></textarea>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Price</label>
                    <input asp-for="Price" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="Price" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Qty</label>
                    <input asp-for="Qty" type="number" class="form-control" />
                    <span asp-validation-for="Qty" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Discount (%)</label>
                    <input asp-for="Discount" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="Discount" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Status</label>
                    <select asp-for="Status" asp-items="Html.GetEnumSelectList<ActiveStatus>()" class="form-control">
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Color</label>
                    <input asp-for="Color" type="color" class="form-control" />
                    <span asp-validation-for="Color" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">STORGE</label>
                    <select asp-for="Storage" class="form-control">
                        <option value="">-- Chọn STORGE --</option>
                        <option value="64 GB">64 GB</option>
                        <option value="128 GB">128 GB</option>
                        <option value="256 GB">256 GB</option>
                        <option value="512 GB">512 GB</option>
                        <option value="1 TB">1 TB</option>
                    </select>
                    <span asp-validation-for="Storage" class="text-danger"></span>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">RAM</label>
                    <select asp-for="Ram" class="form-control">
                        <option value="">-- Chọn RAM --</option>
                        <option value="4 GB">4 GB</option>
                        <option value="6 GB">6 GB</option>
                        <option value="8 GB">8 GB</option>
                        <option value="12 GB">12 GB</option>
                        <option value="16 GB">16 GB</option>
                        <option value="32 GB">32 GB</option>
                    </select>
                    <span asp-validation-for="Ram" class="text-danger"></span>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Cổng kết nối</label>
                    <select asp-for="Port" class="form-control">
                        <option value="">-- Chọn cổng kết nối --</option>
                        <option value="USB Type-C">USB Type-C</option>
                        <option value="USB 3.0">USB 3.0</option>
                        <option value="Lightning">Lightning</option>
                        <option value="Jack 3.5mm">Jack 3.5mm</option>
                        <option value="HDMI">HDMI</option>
                        <option value="Micro USB">Micro USB</option>
                    </select>
                    <span asp-validation-for="Port" class="text-danger"></span>
                </div>

                <!-- Category: chọn 1 trong 5 (1..5) -->
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold d-block">Category (1 trong 5)</label>
                    <select asp-for="ProductCategoryId" class="form-control show-tick">
                        @foreach (var cat in categories)
                        {
                            <option value="@cat.ProductCategoryId">@cat.CategoryName</option>
                        }
                    </select>
                </div>

                @if (Model.ExistingImages?.Count > 0)
                {
                    <div class="mb-3">
                        <label class="form-label fw-bold">Ảnh hiện có</label>

                        <div class="img-scroll-row">
                            @foreach (var img in Model.ExistingImages)
                            {
                                <div class="img-item">
                                    <div class="img-wrap">
                                        <img src="~/images/products/@img.ImageUrl" alt="old image" />
                                        @if (img.IsMain)
                                        {
                                            <span class="badge-main">Main</span>
                                        }
                                    </div>
                                </div>
                            }
                        </div>

                        <small class="text-muted d-block mt-1">
                            Các ảnh này sẽ bị thay thế nếu bạn upload danh sách ảnh mới.
                        </small>
                    </div>
                }

                <!-- 1 ảnh duy nhất -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Product Images (có thể chọn nhiều)</label>
                    <input asp-for="ImageFiles" type="file" class="form-control" multiple accept=".jpg,.jpeg,.png,.gif,.webp,.jfif" />
                    <small class="text-muted">Giữ Ctrl/Shift để chọn nhiều ảnh.</small>
                </div>

                <!-- Chọn ảnh chính (không bắt buộc). Nếu không chọn, server sẽ lấy file đầu tiên -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Ảnh chính (index bắt đầu từ 0)</label>
                    <input asp-for="MainImageIndex" type="number" class="form-control" value="-1" />
                    <small class="text-muted">Để -1 nếu muốn ảnh đầu tiên là ảnh chính.</small>
                </div>
            </div>

            <div class="mt-3">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Save
                </button>
                <a asp-action="Mac" class="btn btn-secondary">Back to list</a>
            </div>
        </form>
    </div>
</div>
